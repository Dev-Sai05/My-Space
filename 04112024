@PostMapping("/Balance_Enq")
public ResponseEntity<ResponseBean> balanceEnquiry(@RequestBody RequestBean reqBean) {
    ResponseBean errorResponse = new ResponseBean();
    ExecutorService executor = Executors.newFixedThreadPool(2);

    try {
        CompletableFuture<Void> validationFuture = CompletableFuture.runAsync(() -> {
            validateAccountNum(reqBean.getAccNo());
            validateBranchNum(reqBean.getBranchNo());
            validateTeller(reqBean.getTellerId());
        }, executor);

        CompletableFuture<ResponseBean> cobolFuture = CompletableFuture.supplyAsync(() -> {
            validateSyscMode(reqBean);
            return callCobolAndFetchData(reqBean);
        }, executor);

        // Wait for validation to complete
        return validationFuture
                .handle((result, ex) -> {
                    if (ex != null) {
                        // Cancel COBOL task if validation failed
                        cobolFuture.cancel(true);
                        throw new CompletionException(ex.getCause());
                    }
                    return null;
                })
                .thenCompose(ignored -> cobolFuture)
                .thenApply(ResponseEntity::ok)
                .exceptionally(ex -> {
                    Throwable cause = ex.getCause() != null ? ex.getCause() : ex;
                    errorResponse.setResponseCode("999");
                    errorResponse.setResponseMessage("Error: " + cause.getMessage());
                    return ResponseEntity.badRequest().body(errorResponse);
                })
                .get(); // Block until all done

    } catch (Exception e) {
        errorResponse.setResponseCode("999");
        errorResponse.setResponseMessage("Internal error: " + e.getMessage());
        return ResponseEntity.internalServerError().body(errorResponse);
    } finally {
        executor.shutdown();
    }
}